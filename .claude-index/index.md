# Project Index: MasLab-Forge-Pro

> Auto-generated by project-indexer | Last updated: 2026-02-11

## Project Overview

- **Type:** Library/Framework (Monorepo)
- **Languages:** TypeScript (100%)
- **Frameworks:** Node.js, Vitest, tsup
- **Entry Points:** `packages/core/src/index.ts`, `packages/cli/src/index.ts`
- **Version:** 0.1.0 (Early Development)
- **Purpose:** Multi-Agent Governance Framework with three-tier hierarchy and political science-inspired governance mechanisms

## Feature Map

### Core Types System (`packages/core/src/types/`)
Entry: `packages/core/src/types/index.ts`
- Fundamental type definitions for agents, messages, decisions, and governance
- **Key exports:**
  - `AgentLayer` - Type for three-tier hierarchy: 'top' | 'mid' | 'bottom'
  - `AgentStatus` - Enum for agent operational states (INITIALIZING, IDLE, WORKING, etc.)
  - `AgentConfig` - Interface for agent configuration with capabilities and hierarchy
  - `AgentMetrics` - Performance tracking metrics for agents
  - `MessageType` - Enum for 40+ inter-agent message types
  - `MessagePriority` - Enum for message priority levels (LOW, NORMAL, HIGH, URGENT)
  - `Message` - Interface for inter-agent communication structure
  - `DecisionType` - Enum for governance decision types requiring signatures
  - `Decision` - Interface for governance decision workflow
  - `Task` - Interface for task configuration and lifecycle
  - `ExecutionMode` - Type for execution modes: 'auto' | 'semi-auto'
  - `AuditEvent` - Interface for governance audit tracking
  - `ElectionResult` - Interface for performance-based elections

### Persistence Layer (`packages/core/src/persistence/`)
Entry: `packages/core/src/persistence/index.ts`
- SQLite-based persistence with type-safe repositories and backup utilities
- **Key exports:**
  - `DatabaseManager` - Main database connection and lifecycle manager
  - `TaskRepository` - CRUD operations for tasks
  - `AgentRepository` - CRUD operations for agents with layer/status queries
  - `MessageRepository` - Message storage and retrieval
  - `DecisionRepository` - Decision tracking for governance
  - `AuditRepository` - Audit event logging
  - `ElectionRepository` - Election result storage
  - `DatabaseBackupManager` - Database backup and restore utilities
  - Row types: `TaskRow`, `AgentRow`, `MessageRow`, `DecisionRow`, `AuditRow`, `ElectionRow`

### Logging System (`packages/core/src/logging/`)
Entry: `packages/core/src/logging/index.ts`
- Category-based structured logging with pino, supporting file and console output
- **Key exports:**
  - `LoggerFactory` - Creates category-specific loggers
  - `AuditLogger` - Specialized logger for audit events
  - `PerformanceLogger` - Performance metrics logging
  - `LogRotationManager` - Log file rotation and cleanup
  - `LogCategory` - Type for log categories (message-bus, audit, performance, etc.)
  - `LoggerConfig` - Logger configuration interface

### CLI Tool (`packages/cli/src/`)
Entry: `packages/cli/src/index.ts`
- Command-line interface for managing multi-agent teams (implementation in progress)
- **Key commands:**
  - `magf start <task>` - Start a new multi-agent task
  - `magf status` - Show current task status
  - `magf pause` - Pause the current task
  - `magf resume` - Resume a paused task
  - `magf cancel` - Cancel the current task

## Module Dependencies

- `@magf/core` → (standalone, no internal dependencies)
  - `types` → (standalone, pure type definitions)
  - `persistence` → `types` (uses type definitions for repositories)
  - `logging` → (standalone, no internal dependencies)
- `@magf/cli` → `@magf/core` (uses core framework types and APIs)

## File Index

### packages/core/src/types/
| File | Description |
|------|-------------|
| index.ts | Core type definitions: agents, messages, decisions, tasks, governance structures |

### packages/core/src/persistence/
| File | Description |
|------|-------------|
| index.ts | Persistence layer entry point, re-exports all repositories and utilities |
| database.ts | DatabaseManager class for SQLite connection and lifecycle management |
| schema.ts | Database schema definitions and table creation SQL |
| migrations.ts | Database migration system for schema versioning |
| backup.ts | DatabaseBackupManager for backup and restore operations |
| logging.ts | Database-specific logging utilities |
| types.ts | Persistence-specific type definitions |
| row-types.ts | Database row type definitions for type-safe queries |
| repositories.ts | Repository factory and initialization |

### packages/core/src/persistence/repositories/
| File | Description |
|------|-------------|
| index.ts | Repository exports aggregator |
| agent-repository.ts | AgentRepository with CRUD, layer queries, status updates |
| task-repository.ts | TaskRepository with CRUD, filtering, and status management |
| message-repository.ts | MessageRepository for inter-agent message storage |
| decision-repository.ts | DecisionRepository for governance decision tracking |
| audit-repository.ts | AuditRepository for audit event logging |
| election-repository.ts | ElectionRepository for election result storage |

### packages/core/src/logging/
| File | Description |
|------|-------------|
| index.ts | Logging system entry point, re-exports loggers and config |
| logger.ts | LoggerFactory, AuditLogger, PerformanceLogger implementations |
| rotation.ts | LogRotationManager for log file rotation and cleanup |

### packages/cli/src/
| File | Description |
|------|-------------|
| index.ts | CLI entry point with commander-based command definitions |

### packages/core/tests/
| File | Description |
|------|-------------|
| types.test.ts | Unit tests for core type definitions |

### Root Configuration Files
| File | Description |
|------|-------------|
| package.json | Root monorepo configuration with workspaces and scripts |
| tsconfig.json | TypeScript configuration for the entire monorepo |
| vitest.config.ts | Vitest test configuration with coverage settings |
| .eslintrc.json | ESLint configuration for code quality |
| .prettierrc | Prettier configuration for code formatting |
| CLAUDE.md | Project instructions for Claude Code |
| CONTRIBUTING.md | Contribution guidelines (English-only requirement) |
| README.md | Project documentation and overview |

### packages/core/
| File | Description |
|------|-------------|
| package.json | Core package configuration (@magf/core) |
| tsconfig.json | TypeScript configuration for core package |
| tsup.config.ts | Build configuration for core package |

### packages/cli/
| File | Description |
|------|-------------|
| package.json | CLI package configuration (@magf/cli) |
| tsconfig.json | TypeScript configuration for CLI package |
| tsup.config.ts | Build configuration for CLI package |

## Key Architectural Concepts

### Three-Tier Governance Structure
- **Top Layer (3 agents):** Strategic decisions, conflict arbitration, quality assurance
- **Mid Layer (2-5 agents):** Domain leadership, task coordination, progress monitoring
- **Bottom Layer (4-5 agents):** Task execution, tool invocation, result reporting

### Dynamic Role Generation
Roles are NOT statically predefined. The AI dynamically generates role names and responsibilities based on specific task context.

### Heartbeat Synchronization
4-second heartbeat cycle ensures predictable system behavior. All agents read messages, execute computation, and write output at synchronized intervals.

### Whiteboard System
Markdown-based shared knowledge space. Each layer has its own whiteboard plus a global whiteboard. Agents can read any whiteboard but only write to their own layer and global.

### Governance Mechanisms
Five power balance mechanisms:
1. **Signature:** Major decisions require 2-3 signatures
2. **Veto:** Any authorized party can block decisions
3. **Appeal:** Vetoed decisions can be appealed to arbitration
4. **Accountability:** Warning → Demotion → Dismissal for failures
5. **Election:** Every 50 heartbeats (~3.3 min), agents are evaluated

### Runtime Workspace
`.agent-workspace/` directory (gitignored) contains:
- `whiteboards/` - Layer-specific and global Markdown files
- `task.db` - SQLite database
- `logs/` - Categorized log files

## Development Status

**Current Phase:** Early development (v0.1.0)
- ✅ Type definitions complete
- ✅ Persistence layer implemented
- ✅ Logging system implemented
- ⏳ Agent base classes (planned)
- ⏳ Message bus (planned)
- ⏳ Whiteboard system (planned)
- ⏳ Governance engine (planned)
- ⏳ CLI implementation (skeleton only)

## Testing

- **Framework:** Vitest
- **Coverage Requirement:** 70% minimum (lines, functions, branches, statements)
- **Test Location:** `packages/*/tests/` or co-located `*.test.ts`
- **Current Tests:** 1 test file (types.test.ts)

## Build & Development

```bash
npm install              # Install dependencies
npm run build            # Build all packages
npm run dev              # Build in watch mode
npm test                 # Run tests
npm run ci               # Full CI pipeline (lint + typecheck + test)
```

## Documentation

Comprehensive planning documents in `docs/plans/multi-agent-governance-framework/`:
- `master-plan.md` - Overall project vision and roadmap
- `specs/` - Detailed design specifications (6 documents)
- `todo/` - Task breakdown (10 task documents)
